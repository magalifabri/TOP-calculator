<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="calculator.css">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<div id="calculator">
		<div id="screen">
		</div>
		<div id="buttons-digits">
			<button id="7">7</button>
			<button id="8">8</button>
			<button id="9">9</button>
			<button id="4">4</button>
			<button id="5">5</button>
			<button id="6">6</button>
			<button id="1">1</button>
			<button id="2">2</button>
			<button id="3">3</button>
			<button id="0">0</button>
			<button id=".">.</button>
			<button id="=">=</button>
		</div>
		<div id="buttons-other">
			<button id="clear"><<</button>
			<button id="รท">รท</button>
			<button id="x">x</button>
			<button id="-">-</button>
			<button id="+">+</button>
		</div>
	</div>

	<script>
		// ------------------ MATH OPERATIONS ---------------------
		// returns are converted to fixed point values to avoid annoying floating point decimal shenanigans
		
		function add(a, b) {
			return (+(a + b).toFixed(5));
		}
		function subtract(a, b) {
			return (+(a - b).toFixed(5));
		}
		function multiply(a, b) {
			return (+(a * b).toFixed(5));
		}
		function divide(a, b) {
			return (+(a / b).toFixed(5));
		}

		function operate(operation, a, b) {
			return (operation(a, b));
		}

		// console.log(operate(subtract, 1, 2));

		const screen = document.querySelector("#screen");
		screen.textContent = "";
		
		// const screen2 = document.createElement("p");
		// screen.appendChild(screen2);
		// screen2.textContent = "test";

		
		// ---------------- GET & DISPLAY INPUT --------------------
		

		const buttons = document.querySelectorAll("button");
		// console.log(buttons);
		buttons.forEach(
			function(button) {
				button.addEventListener("click", buttonClick);
			}
		)
		
		let currentOperand = "";
		let storedOperand = "";
		let operator = "";
		let input = ""; // testing purposes

		function buttonClick(e) {
			if (e.target.getAttribute('listenerButtonClick') !== 'true') {
				e.target.setAttribute('listenerButtonClick', 'true');
				console.log('listener attribute set to true');
			}
			
			let btnPressed = e.target.textContent;
			input += btnPressed;
			console.log(input);

			// clear screen and reset everything
			if (btnPressed === "<<") {
				screen.textContent = "";
				currentOperand = "";
				storedOperand = "";
				operator = "";
				input = "";
			}
			
			// operand is being given
			else if ((btnPressed >= "0" && btnPressed <= "9")
			|| btnPressed === ".") {
				// clear screen when a new operand is given
				if (currentOperand === "") {
					screen.textContent = "";
				}
				// store input in current operand
				currentOperand += btnPressed;
				// display input on screen
				screen.textContent += btnPressed;
				// if ".", disable it for the rest of this operand
				// to do: add visual effect
				if (btnPressed === ".") {
					buttons.forEach(
						function(button) {
							if (button.textContent === ".") {
								button.removeEventListener("click", buttonClick);
								button.setAttribute('listenerButtonClick', 'false');
								console.log('listener attribute set to false');
							}
						}
					)
				}
			}

			// result is requested
			else if (btnPressed === "=") {
				// if an operand is missing, return
				if (storedOperand === "" || currentOperand === "" || operator === "") {
					console.log("error: storedOperand = '" + storedOperand
					+ "', currentOperand = '" + currentOperand + "', operator = '" + operator + "'");
					return ;
				}
				// process input to get result and store result
				storedOperand = processInput(operator, storedOperand, currentOperand);
				// display result on screen
				screen.textContent = storedOperand;
				// get ready for new operand input
				currentOperand = "";
				operator = "";
				buttons.forEach(
					function(button) {
						if (button.textContent === ".") {
							button.addEventListener("click", buttonClick);
							button.setAttribute('listenerButtonClick', 'true');
							console.log('listener attribute set to true');
						}
					}
				)
			}

			// an operator is input and we don't have one yet
			else if (operator === "") {
				// store the operator
				operator = btnPressed;
				// if an operand has already been given, get ready for another
				if (currentOperand !== "") {
					storedOperand = currentOperand;
					currentOperand = "";
					buttons.forEach(
						function(button) {
							if (button.textContent === ".") {
								button.addEventListener("click", buttonClick);
								button.setAttribute('listenerButtonClick', 'true');
								console.log('listener attribute set to true');
							}
						}
					)
				}
			}

			// an operator is input, but we already have one
			else {
				// if an operand is missing, return
				if (storedOperand === "" || currentOperand === "") {
					operator = btnPressed;
					console.log("error: storedOperand = '" + storedOperand
					+ "', currentOperand = '" + currentOperand + "', operator = '" + operator + "'");
					return ;
				}
				// process input to get result and store result
				storedOperand = processInput(operator, storedOperand, currentOperand);
				// display result on screen
				screen.textContent = storedOperand;
				// store given operator
				operator = btnPressed;
				// get ready for new operand input
				currentOperand = "";
				buttons.forEach(
					function(button) {
						if (button.textContent === ".") {
							button.addEventListener("click", buttonClick);
							button.setAttribute('listenerButtonClick', 'true');
							console.log('listener attribute set to true');
						}
					}
				)
			}
		}




		
		function processInput(operator, operand1, operand2) {
			// console.log(operands[0] + " " + operands[1]);
			
			// convert strings to floats
			let num1 = parseFloat(operand1);
			let num2 = parseFloat(operand2);
			let result;
			switch (operator) {
				case "x":
					result = operate(multiply, num1, num2);
					break ;
				case "รท":
					result = operate(divide, num1, num2);
					break ;
				case "-":
					result = operate(subtract, num1, num2);
					break ;
				case "+":
					result = operate(add, num1, num2);
					break ;
			}
			// console.log(result);
			return (result);
		}



/*
		let input = [];
		function buttonClickOld(e) {
			if (e.target.textContent === "<<") {
				screen.textContent = "";
				input = [];
			} else if (e.target.textContent === "=") {
				parseInput();
			} else {
				screen.textContent += e.target.textContent;
				input.push(e.target.textContent);
			}
		}
		
		// PARSE INPUT
		function parseInput() {
			let operands = ["", ""];
			let operandIndex = 0;
			let operator = "";

			for (let i = 0; i < input.length; i++) {
				// check if it's (part of) an operand, if so, store it
				if (input[i] >= "0" && input[i] <= "9"
				|| input[i] === ".") {
					operands[operandIndex] += input[i];
				}
				// it's an operator, and we don't have one yet, so:
				else if (operator === "") {
					// - store the operator
					operator = input[i];
					// - get ready to store a second operand
					operandIndex++;
				}
				// it's an operator, but we already have one, so we have to:
				else {
					// - process the two operands we have and put the result in the first operand
					operands[0] = processInput(operator, operands);
					// - put the second operand back to 0
					operands[1] = "";
					// - get ready to store a second operand
					operandIndex = 1;
					// store the new operator
					operator = input[i];
				}
			}

			// GET RESULT
			operands[0] = processInput(operator, operands);
			screen.textContent = operands[0];
			operandIndex = 1;
			operator = undefined;
		}
		
		function processInputOld(operator, operands) {
			// console.log(operands[0] + " " + operands[1]);
			
			// convert strings to floats
			let num1 = parseFloat(operands[0]);
			let num2 = parseFloat(operands[1]);
			let result;
			switch (operator) {
				case "x":
					result = operate(multiply, num1, num2);
					break ;
				case "รท":
					result = operate(divide, num1, num2);
					break ;
				case "-":
					result = operate(subtract, num1, num2);
					break ;
				case "+":
					result = operate(add, num1, num2);
					break ;
			}
			// console.log(result);
			return (result);
		}
		*/
	</script>
</body>
</html>